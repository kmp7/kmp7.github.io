<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç: –∑–∞–∫—Ä—ã—Ç–∞—è —Ñ–æ—Ä–º–∞ ¬∑ –ê–∫–∞–¥–µ–º–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
        :root {
            --bg-page: #ffffff;
            --bg-card: #f5f5f5;
            --bg-header: #f5f5f5;
            --text-primary: #1e2b45;
            --text-secondary: #2c3e5c;
            --accent: #3498db;
            --accent-hover: #2c7cb0;
            --navy: #325980;
            --border-light: #f1f1f1;
            --shadow: 0 8px 20px rgba(0,0,0,0.02), 0 2px 6px rgba(0,40,80,0.05);
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --input-border: #e0e6ed;
            --success: #2ecc71;
            --error: #e74c3c;
        }

        body.dark {
            --bg-page: #1a2634;
            --bg-card: #253241;
            --bg-header: #1e2a36;
            --text-primary: #ecf0f3;
            --text-secondary: #cbd5e1;
            --accent: #5faee3;
            --accent-hover: #78b9e8;
            --navy: #4f7aa6;
            --border-light: #2f3e4e;
            --shadow: 0 8px 20px rgba(0,0,0,0.4);
            --card-bg: #2a3848;
            --input-bg: #1f2c3a;
            --input-border: #3e5062;
            --success: #2ecc71;
            --error: #e74c3c;
        }

        body {
            background-color: var(--bg-page);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.2s, color 0.2s;
        }

        /* —Ö—ç–¥–µ—Ä */
        .app-header {
            background-color: var(--bg-header);
            border-bottom: 2px solid var(--navy);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            box-shadow: var(--shadow);
        }

        .logo h1 {
            font-size: 1.6rem;
            font-weight: 500;
            color: var(--navy);
            letter-spacing: -0.02em;
        }

        .theme-toggle button {
            background: none;
            border: 2px solid var(--border-light);
            border-radius: 40px;
            padding: 0.4rem 1.2rem;
            font-size: 1.2rem;
            cursor: pointer;
            background-color: var(--card-bg);
            color: var(--navy);
            transition: 0.15s;
            box-shadow: var(--shadow);
        }

        .theme-toggle button:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            width: 100%;
            flex: 1;
        }

        /* –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è) */
        .info-card {
            background-color: var(--bg-card);
            border-left: 6px solid var(--navy);
            padding: 1.5rem 2rem;
            border-radius: 12px;
            margin-bottom: 2.5rem;
            box-shadow: var(--shadow);
        }

        .info-card h2 {
            color: var(--navy);
            font-weight: 500;
            margin-bottom: 0.75rem;
            font-size: 1.5rem;
        }

        .info-card p {
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        .info-card ul {
            margin-left: 1.5rem;
            color: var(--text-secondary);
        }

        /* —Ñ–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ */
        .user-section {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border-light);
        }

        .user-form {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: flex-end;
        }

        .input-group {
            flex: 2 1 260px;
        }

        .input-group label {
            display: block;
            font-weight: 500;
            color: var(--navy);
            margin-bottom: 0.4rem;
            font-size: 0.95rem;
        }

        .input-group input {
            width: 100%;
            padding: 0.9rem 1.2rem;
            background-color: var(--input-bg);
            border: 1.5px solid var(--input-border);
            border-radius: 40px;
            font-size: 1rem;
            color: var(--text-primary);
            transition: 0.15s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .btn-primary {
            background-color: var(--accent);
            border: none;
            color: white;
            font-weight: 600;
            padding: 0.9rem 2.2rem;
            border-radius: 40px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.15s;
            box-shadow: 0 4px 10px rgba(52,152,219,0.3);
            border: 1px solid transparent;
        }

        .btn-primary:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        /* —Ç–∞–π–º–µ—Ä –∏ —Å—Ç–∞—Ç—É—Å */
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--bg-card);
            padding: 1rem 2rem;
            border-radius: 60px;
            margin-bottom: 2rem;
            border: 1px solid var(--border-light);
        }

        .timer {
            font-size: 1.6rem;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            color: var(--navy);
            background: var(--card-bg);
            padding: 0.3rem 1.2rem;
            border-radius: 40px;
            box-shadow: var(--shadow);
        }

        .progress {
            color: var(--text-secondary);
        }

        /* –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ */
        .question {
            background-color: var(--card-bg);
            border-radius: 32px;
            padding: 2rem;
            margin-bottom: 1.8rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-light);
        }

        .question h3 {
            font-weight: 500;
            color: var(--navy);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--border-light);
            padding-bottom: 0.6rem;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 1.2rem;
            background-color: var(--bg-page);
            border-radius: 60px;
            border: 1.5px solid var(--input-border);
            transition: 0.1s;
            cursor: pointer;
        }

        .option:hover {
            border-color: var(--accent);
            background-color: var(--bg-card);
        }

        .option input[type="radio"] {
            appearance: none;
            width: 1.3rem;
            height: 1.3rem;
            border: 2px solid var(--navy);
            border-radius: 50%;
            position: relative;
            cursor: pointer;
            transition: 0.1s;
        }

        .option input[type="radio"]:checked {
            border-color: var(--accent);
            background-color: var(--accent);
            box-shadow: inset 0 0 0 4px var(--card-bg);
        }

        .option label {
            flex: 1;
            font-size: 1.05rem;
            color: var(--text-primary);
            cursor: pointer;
        }

        .submit-area {
            margin-top: 2.5rem;
            display: flex;
            justify-content: center;
        }

        .btn-large {
            background-color: var(--navy);
            color: white;
            border: none;
            padding: 1.2rem 3rem;
            border-radius: 60px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.15s;
            box-shadow: var(--shadow);
        }

        .btn-large:hover {
            background-color: var(--accent);
            transform: scale(1.02);
        }

        /* –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç) */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: var(--card-bg);
            max-width: 500px;
            width: 90%;
            padding: 2.5rem 2rem;
            border-radius: 48px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
            border: 2px solid var(--navy);
            text-align: center;
        }

        .modal-content h2 {
            color: var(--navy);
            font-size: 2rem;
            margin-bottom: 1.2rem;
        }

        .modal-content p {
            margin: 0.7rem 0;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .success-badge {
            background-color: var(--success);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 40px;
            display: inline-block;
            margin: 1rem 0;
            font-weight: 600;
        }

        .fail-badge {
            background-color: var(--error);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 40px;
            display: inline-block;
            margin: 1rem 0;
            font-weight: 600;
        }

        .modal-close {
            background-color: var(--accent);
            border: none;
            color: white;
            padding: 0.8rem 2rem;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 1rem;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .modal-close:hover {
            background-color: var(--accent-hover);
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-light);
            margin-top: 2rem;
        }

        /* –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 600px) {
            .app-header {
                padding: 1rem;
            }
            .container {
                padding: 0 1rem;
            }
            .user-form {
                flex-direction: column;
                align-items: stretch;
            }
            .btn-primary {
                width: 100%;
            }
            .test-header {
                flex-direction: column;
                gap: 0.5rem;
                border-radius: 30px;
            }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="logo">
            <h1>–¢–∏–ø–∞ —Ç–µ—Å—Ç</h1>
        </div>
        <div class="theme-toggle">
            <button id="themeSwitcher">‚òÄÔ∏è / üåô</button>
        </div>
    </header>

    <main class="container" id="app">
        <!-- –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ -->
        <div class="info-card">
            <h2>–û—Ç–∫—Ä—ã—Ç–∞—è —Ñ–æ—Ä–º–∞</h2>
            <p>–í–∞–º –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è 5 –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –∫—Ä–∞—Ç–∫–∏–º–∏ —Å–≤–æ–±–æ–¥–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏. LLM-–≤–∞–ª–∏–¥–∞—Ü–∏—è (—Å–∏–º—É–ª—è—Ü–∏—è).</p>
            <ul>
                <li>–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–º—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç—É.</li>
                <li>–ù–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—ë—Ç—Å—è <strong>3 –º–∏–Ω—É—Ç—ã</strong>.</li>
                <li>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–µ –º–µ–Ω–µ–µ 80% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (‚â•4 –∏–∑ 5).</li>
                <li>–û—Ç–≤–µ—Ç—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ: —Å–∏–Ω–æ–Ω–∏–º—ã, –ø–∞—Ä–∞—Ñ—Ä–∞–∑, –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.</li>
                <li>–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É–≤–∏–¥–∏—Ç–µ –∏–º–µ–Ω–Ω–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.</li>
            </ul>
        </div>

        <!-- –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —á–µ—Ä–µ–∑ js) -->
        <div id="dynamicContent"></div>
    </main>

        <script>
        (function(){
            // --- –≤–æ–ø—Ä–æ—Å—ã –æ—Ç–∫—Ä—ã—Ç–æ–π —Ñ–æ—Ä–º—ã —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π ---
            const QUESTIONS = [
                {
                    text: '–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —á–∞—Å—Ç—å —Ä–µ—á–∏, –∫–æ—Ç–æ—Ä–∞—è –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ?',
                    correctAnswers: ['–≥–ª–∞–≥–æ–ª', 'verb', '–≥–ª–∞–≥–æ–ª (verb)', '–≥–ª–∞–≥–æ–ª—ã'], // –ø—Ä–∏–Ω–∏–º–∞–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                    hint: '–≥–ª–∞–≥–æ–ª / verb'
                },
                {
                    text: '–ù–∞–ø–∏—à–∏—Ç–µ —Ñ–æ—Ä–º—É 3-–≥–æ –ª–∏—Ü–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≥–ª–∞–≥–æ–ª–∞ "to be".',
                    correctAnswers: ['is', 'i–∑', '–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ'], // is
                    hint: 'is'
                },
                {
                    text: '–ö–∞–∫–æ–π –∞—Ä—Ç–∏–∫–ª—å (a/an/the) —Å—Ç–∞–≤–∏—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–ª–æ–≤–æ–º "hour"?',
                    correctAnswers: ['an', '–∞–Ω', 'an hour'],
                    hint: 'an'
                },
                {
                    text: '–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—Ä–µ–º—è (Past Simple / Present Perfect / Past Continuous), –∫–æ—Ç–æ—Ä–æ–µ –æ–±—Ä–∞–∑—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é "have/has + V3"?',
                    correctAnswers: ['present perfect', 'present perfect tense', 'pr perfect', '–ø–µ—Ä—Ñ–µ–∫—Ç', '–ø—Ä–µ–∑–µ–Ω—Ç –ø–µ—Ä—Ñ–µ–∫—Ç'],
                    hint: 'Present Perfect'
                },
                {
                    text: '–ù–∞–ø–∏—à–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–µ —Å–ª–æ–≤–æ: "If I _____ (be) you, I would study harder."',
                    correctAnswers: ['were', 'was'], // –¥–æ–ø—É—Å—Ç–∏–º were (—Å–æ—Å–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ)
                    hint: 'were (—Å–æ—Å–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∫–ª–æ–Ω–µ–Ω–∏–µ)'
                }
            ];

            // —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            let student = { firstName: '', lastName: '' };
            let testStarted = false;
            let testCompleted = false;
            let timeLeft = 180; // 3 –º–∏–Ω—É—Ç—ã
            let timerInterval = null;
            let startTimestamp = null;
            let endTimestamp = null;
            let userAnswers = ['', '', '', '', '']; // —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã
            let testDurationSeconds = 0;

            // —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ü–µ–Ω–∫–∏ (true/false –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
            let answerResults = [false, false, false, false, false];

            const dynamicEl = document.getElementById('dynamicContent');
            const themeBtn = document.getElementById('themeSwitcher');

            themeBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark');
            });

            function normalizeAnswer(str) {
                return str.trim().toLowerCase().replace(/[.,!?;:]$/, '').replace(/[.,!?;:]/g, ' ').replace(/\s+/g, ' ').trim();
            }

            function isAnswerCorrect(questionIdx, userAnswer) {
                if (!userAnswer) return false;
                const normalized = normalizeAnswer(userAnswer);
                const question = QUESTIONS[questionIdx];
                return question.correctAnswers.some(correct => {
                    const normCorrect = normalizeAnswer(correct);
                    return normalized === normCorrect || normalized.includes(normCorrect) || normCorrect.includes(normalized);
                });
            }

            // –æ–±–Ω–æ–≤–∏—Ç—å –º–∞—Å—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            function evaluateAllAnswers() {
                for (let i = 0; i < QUESTIONS.length; i++) {
                    answerResults[i] = isAnswerCorrect(i, userAnswers[i]);
                }
            }

            function render() {
                if (!testStarted) {
                    renderWelcome();
                } else if (testCompleted) {
                    renderResults();
                } else {
                    renderTest();
                }
            }

            function renderWelcome() {
                dynamicEl.innerHTML = `
                    <div class="user-section">
                        <h2 style="color: var(--navy); margin-bottom: 1.5rem;">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ</h2>
                        <div class="user-form">
                            <div class="input-group">
                                <label>–§–∞–º–∏–ª–∏—è</label>
                                <input type="text" id="lastNameInput" placeholder="–ü–µ—Ç—Ä–æ–≤" value="${student.lastName}">
                            </div>
                            <div class="input-group">
                                <label>–ò–º—è</label>
                                <input type="text" id="firstNameInput" placeholder="–ü—ë—Ç—Ä" value="${student.firstName}">
                            </div>
                            <button class="btn-primary" id="startTestBtn">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
                        </div>
                    </div>
                `;

                document.getElementById('startTestBtn')?.addEventListener('click', () => {
                    const first = document.getElementById('firstNameInput')?.value.trim();
                    const last = document.getElementById('lastNameInput')?.value.trim();
                    if (!first || !last) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é.');
                        return;
                    }
                    student.firstName = first;
                    student.lastName = last;
                    testStarted = true;
                    startTimestamp = Date.now();
                    timeLeft = 180;
                    userAnswers = ['', '', '', '', ''];
                    answerResults = [false, false, false, false, false];
                    startTimer();
                    render();
                });
            }

            function renderTest() {
                const questionBlocks = QUESTIONS.map((q, idx) => {
                    return `
                        <div class="question">
                            <h3>${idx+1}. ${q.text}</h3>
                            <div style="margin-top: 1rem;">
                                <input type="text" class="open-answer" id="ans${idx}" 
                                    placeholder="–í–∞—à –æ—Ç–≤–µ—Ç" value="${userAnswers[idx]}" 
                                    style="width: 100%; padding: 1rem 1.2rem; background-color: var(--input-bg); border: 1.5px solid var(--input-border); border-radius: 60px; font-size: 1rem; color: var(--text-primary);">
                                <small style="color: var(--text-secondary); margin-top: 0.5rem; display: block;">‚ìò –ø–æ–¥—Å–∫–∞–∑–∫–∞: ${q.hint}</small>
                            </div>
                        </div>
                    `;
                }).join('');

                dynamicEl.innerHTML = `
                    <div class="test-header">
                        <span class="progress">‚è≥ –æ—Å—Ç–∞–ª–æ—Å—å</span>
                        <span class="timer" id="timerDisplay">03:00</span>
                    </div>
                    <form id="testForm">
                        ${questionBlocks}
                        <div class="submit-area">
                            <button type="button" class="btn-large" id="submitTestBtn">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</button>
                        </div>
                    </form>
                `;

                // –ø—Ä–∏–≤—è–∑–∫–∞ –≤–≤–æ–¥–∞
                for (let i = 0; i < QUESTIONS.length; i++) {
                    const input = document.getElementById(`ans${i}`);
                    if (input) {
                        input.addEventListener('input', (e) => {
                            userAnswers[i] = e.target.value;
                        });
                    }
                }

                document.getElementById('submitTestBtn').addEventListener('click', finishTest);
                updateTimerDisplay();
            }

            function renderResults() {
                evaluateAllAnswers(); // —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
                const correctCount = answerResults.filter(Boolean).length;
                const percent = (correctCount / QUESTIONS.length) * 100;
                const passed = percent >= 80;

                const now = endTimestamp ? new Date(endTimestamp) : new Date();
                const dateStr = now.toLocaleDateString('ru-RU');
                const timeStr = now.toLocaleTimeString('ru-RU', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
                const durationMinutes = Math.floor(testDurationSeconds / 60);
                const durationSeconds = testDurationSeconds % 60;
                const durationStr = `${durationMinutes} –º–∏–Ω ${durationSeconds} —Å–µ–∫`;

                // –¥–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –æ—Ç–≤–µ—Ç–æ–≤
                const detailRows = QUESTIONS.map((q, i) => {
                    const status = answerResults[i] ? '‚úì' : '‚úó';
                    const userAns = userAnswers[i] || '(–ø—É—Å—Ç–æ)';
                    return `<tr><td>${i+1}</td><td>${userAns}</td><td>${status}</td><td>${q.hint}</td></tr>`;
                }).join('');

                const modalHtml = `
                    <div class="modal" id="resultModal">
                        <div class="modal-content" style="max-width: 600px;">
                            <h2>${passed ? 'üéì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç' : 'üìã –†–µ–∑—É–ª—å—Ç–∞—Ç'}</h2>
                            <p><strong>${student.lastName} ${student.firstName}</strong></p>
                            ${passed ? '<div class="success-badge">‚úì —É—Å–ø–µ—à–Ω–æ (‚â•80%)</div>' : '<div class="fail-badge">‚úó –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ (<80%)</div>'}
                            <p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${correctCount} –∏–∑ ${QUESTIONS.length} (${Math.round(percent)}%)</p>
                            <p>–î–∞—Ç–∞: ${dateStr} ¬∑ –í—Ä–µ–º—è: ${timeStr} ¬∑ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${durationStr}</p>
                            
                            <table style="width:100%; margin-top:1rem; border-collapse: collapse; text-align:left; font-size:0.9rem;">
                                <thead><tr style="border-bottom:2px solid var(--navy);"><th>#</th><th>–í–∞—à –æ—Ç–≤–µ—Ç</th><th></th><th>–û–∂–∏–¥–∞–ª–æ—Å—å</th></tr></thead>
                                <tbody>${detailRows}</tbody>
                            </table>

                            ${!passed ? '<p style="margin-top:1rem;">‚ûú –ü—Ä–∏–≥–ª–∞—à–∞–µ–º –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ</p>' : ''}
                            <button class="modal-close" id="modalCloseBtn">${passed ? '–ó–∞–∫—Ä—ã—Ç—å' : '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞'}</button>
                        </div>
                    </div>
                `;

                dynamicEl.innerHTML = modalHtml;

                document.getElementById('modalCloseBtn').addEventListener('click', () => {
                    if (!passed) {
                        testStarted = false;
                        testCompleted = false;
                        student.firstName = '';
                        student.lastName = '';
                        timeLeft = 180;
                        userAnswers = ['', '', '', '', ''];
                        answerResults = [false, false, false, false, false];
                        if (timerInterval) clearInterval(timerInterval);
                        timerInterval = null;
                        render();
                    } else {
                        document.getElementById('resultModal')?.remove();
                        testStarted = false;
                        testCompleted = false;
                        student.firstName = '';
                        student.lastName = '';
                        timeLeft = 180;
                        if (timerInterval) clearInterval(timerInterval);
                        timerInterval = null;
                        render();
                    }
                });
            }

            function startTimer() {
                if (timerInterval) clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    if (testCompleted) return;
                    timeLeft -= 1;
                    if (timeLeft <= 0) {
                        timeLeft = 0;
                        clearInterval(timerInterval);
                        if (!testCompleted) finishTest();
                    }
                    updateTimerDisplay();
                }, 1000);
            }

            function updateTimerDisplay() {
                const timerEl = document.getElementById('timerDisplay');
                if (timerEl) {
                    const mins = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                    const secs = (timeLeft % 60).toString().padStart(2, '0');
                    timerEl.textContent = `${mins}:${secs}`;
                }
            }

            function finishTest() {
                if (testCompleted) return;
                clearInterval(timerInterval);
                timerInterval = null;
                endTimestamp = Date.now();
                testDurationSeconds = Math.round((endTimestamp - startTimestamp) / 1000);
                testCompleted = true;

                // –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤
                for (let i = 0; i < QUESTIONS.length; i++) {
                    const input = document.getElementById(`ans${i}`);
                    if (input) userAnswers[i] = input.value;
                }

                render();
            }

            render();
        })();
    </script>
</body>
</html>