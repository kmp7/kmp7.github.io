<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç: –∑–∞–∫—Ä—ã—Ç–∞—è —Ñ–æ—Ä–º–∞ ¬∑ –ê–∫–∞–¥–µ–º–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
        :root {
            --bg-page: #ffffff;
            --bg-card: #f5f5f5;
            --bg-header: #f5f5f5;
            --text-primary: #1e2b45;
            --text-secondary: #2c3e5c;
            --accent: #3498db;
            --accent-hover: #2c7cb0;
            --navy: #325980;
            --border-light: #f1f1f1;
            --shadow: 0 8px 20px rgba(0,0,0,0.02), 0 2px 6px rgba(0,40,80,0.05);
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --input-border: #e0e6ed;
            --success: #2ecc71;
            --error: #e74c3c;
        }

        body.dark {
            --bg-page: #1a2634;
            --bg-card: #253241;
            --bg-header: #1e2a36;
            --text-primary: #ecf0f3;
            --text-secondary: #cbd5e1;
            --accent: #5faee3;
            --accent-hover: #78b9e8;
            --navy: #4f7aa6;
            --border-light: #2f3e4e;
            --shadow: 0 8px 20px rgba(0,0,0,0.4);
            --card-bg: #2a3848;
            --input-bg: #1f2c3a;
            --input-border: #3e5062;
            --success: #2ecc71;
            --error: #e74c3c;
        }

        body {
            background-color: var(--bg-page);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.2s, color 0.2s;
        }

        .app-header {
            background-color: var(--bg-header);
            border-bottom: 2px solid var(--navy);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            box-shadow: var(--shadow);
        }

        .logo h1 {
            font-size: 1.6rem;
            font-weight: 500;
            color: var(--navy);
            letter-spacing: -0.02em;
        }

        .theme-toggle button {
            background: none;
            border: 2px solid var(--border-light);
            border-radius: 40px;
            padding: 0.4rem 1.2rem;
            font-size: 1.2rem;
            cursor: pointer;
            background-color: var(--card-bg);
            color: var(--navy);
            transition: 0.15s;
            box-shadow: var(--shadow);
        }

        .theme-toggle button:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            width: 100%;
            flex: 1;
        }

        /* –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è) */
        .info-card {
            background-color: var(--bg-card);
            border-left: 6px solid var(--navy);
            padding: 1.5rem 2rem;
            border-radius: 12px;
            margin-bottom: 2.5rem;
            box-shadow: var(--shadow);
        }

        .info-card h2 {
            color: var(--navy);
            font-weight: 500;
            margin-bottom: 0.75rem;
            font-size: 1.5rem;
        }

        .info-card p {
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        .info-card ul {
            margin-left: 1.5rem;
            color: var(--text-secondary);
        }

        /* —Ñ–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ */
        .user-section {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border-light);
        }

        .user-form {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: flex-end;
        }

        .input-group {
            flex: 2 1 260px;
        }

        .input-group label {
            display: block;
            font-weight: 500;
            color: var(--navy);
            margin-bottom: 0.4rem;
            font-size: 0.95rem;
        }

        .input-group input {
            width: 100%;
            padding: 0.9rem 1.2rem;
            background-color: var(--input-bg);
            border: 1.5px solid var(--input-border);
            border-radius: 12px;
            font-size: 1rem;
            color: var(--text-primary);
            transition: 0.15s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .btn-primary {
            background-color: var(--accent);
            border: none;
            color: white;
            font-weight: 600;
            padding: 0.9rem 2.2rem;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.15s;
            box-shadow: 0 4px 10px rgba(52,152,219,0.3);
            border: 1px solid transparent;
        }

        .btn-primary:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        /* —Ç–∞–π–º–µ—Ä –∏ —Å—Ç–∞—Ç—É—Å */
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--bg-card);
            padding: 1rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid var(--border-light);
        }

        .timer {
            font-size: 1.6rem;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            color: var(--navy);
            background: var(--card-bg);
            padding: 0.3rem 1.2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .progress {
            color: var(--text-secondary);
        }

        /* –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ */
        .question {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.8rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-light);
        }

        .question h3 {
            font-weight: 500;
            color: var(--navy);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--border-light);
            padding-bottom: 0.6rem;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 1.2rem;
            background-color: var(--bg-page);
            border-radius: 12px;
            border: 1.5px solid var(--input-border);
            transition: 0.1s;
            cursor: pointer;
        }

        .option:hover {
            border-color: var(--accent);
            background-color: var(--bg-card);
        }

        .option input[type="radio"] {
            appearance: none;
            width: 1.3rem;
            height: 1.3rem;
            border: 2px solid var(--navy);
            border-radius: 50%;
            position: relative;
            cursor: pointer;
            transition: 0.1s;
        }

        .option input[type="radio"]:checked {
            border-color: var(--accent);
            background-color: var(--accent);
            box-shadow: inset 0 0 0 4px var(--card-bg);
        }

        .option label {
            flex: 1;
            font-size: 1.05rem;
            color: var(--text-primary);
            cursor: pointer;
        }

        .submit-area {
            margin-top: 2.5rem;
            display: flex;
            justify-content: center;
        }

        .btn-large {
            background-color: var(--navy);
            color: white;
            border: none;
            padding: 1.2rem 3rem;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.15s;
            box-shadow: var(--shadow);
        }

        .btn-large:hover {
            background-color: var(--accent);
            transform: scale(1.02);
        }

        /* –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç) */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: var(--card-bg);
            max-width: 500px;
            width: 90%;
            padding: 2.5rem 2rem;
            border-radius: 12px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
            border: 2px solid var(--navy);
            text-align: center;
        }

        .modal-content h2 {
            color: var(--navy);
            font-size: 2rem;
            margin-bottom: 1.2rem;
        }

        .modal-content p {
            margin: 0.7rem 0;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .success-badge {
            background-color: var(--success);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 12px;
            display: inline-block;
            margin: 1rem 0;
            font-weight: 600;
        }

        .fail-badge {
            background-color: var(--error);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 12px;
            display: inline-block;
            margin: 1rem 0;
            font-weight: 600;
        }

        .modal-close {
            background-color: var(--accent);
            border: none;
            color: white;
            padding: 0.8rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 1rem;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .modal-close:hover {
            background-color: var(--accent-hover);
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-light);
            margin-top: 2rem;
        }

        /* –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 600px) {
            .app-header {
                padding: 1rem;
            }
            .container {
                padding: 0 1rem;
            }
            .user-form {
                flex-direction: column;
                align-items: stretch;
            }
            .btn-primary {
                width: 100%;
            }
            .test-header {
                flex-direction: column;
                gap: 0.5rem;
                border-radius: 12px;
            }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="logo">
            <h1>–¢–∏–ø–∞ —Ç–µ—Å—Ç</h1>
        </div>
        <div class="theme-toggle">
            <button id="themeSwitcher">‚òÄÔ∏è / üåô</button>
        </div>
    </header>

    <main class="container" id="app">
        <!-- –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ -->
        <div class="info-card">
            <h2>–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º</h2>
            <ul>
                <li>–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–º—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç—É.</li>
                <li>–ù–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—ë—Ç—Å—è <strong>30 —Å–µ–∫—É–Ω–¥</strong>.</li>
                <li>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–µ –º–µ–Ω–µ–µ 80% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (4 –∏–∑ 5).</li>
                <li>–ß—Ç–æ–±—ã —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –ø—Ä–∞–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –µ—ë –Ω–∞ –ª–µ–≤—É—é.</li>
                <li>–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É–≤–∏–¥–∏—Ç–µ –∏–º–µ–Ω–Ω–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.</li>
            </ul>
        </div>

        <!-- –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —á–µ—Ä–µ–∑ js) -->
        <div id="dynamicContent"></div>
    </main>

    <footer>
        <p>¬© –ï–≤–∞ –ê–¥–∞–º–æ–≤–Ω–∞ –û—Ä–ª–æ–≤–∞ | —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ drag & drop</p>
    </footer>

    <script>
        (function(){
            // --- –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è ---
            const LEFT_ITEMS = [
                { id: 'left0', text: 'Present Simple' },
                { id: 'left1', text: 'Present Continuous' },
                { id: 'left2', text: 'Present Perfect' },
                { id: 'left3', text: 'Past Simple' },
                { id: 'left4', text: 'Future Simple (will)' }
            ];

            const RIGHT_ITEMS = [
                { id: 'right0', text: '—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, —Ñ–∞–∫—Ç—ã', correctLeftId: 'left0' },
                { id: 'right1', text: '–¥–µ–π—Å—Ç–≤–∏–µ –≤ –º–æ–º–µ–Ω—Ç —Ä–µ—á–∏', correctLeftId: 'left1' },
                { id: 'right2', text: '—Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –Ω–∞—Å—Ç–æ—è—â–µ–º', correctLeftId: 'left2' },
                { id: 'right3', text: '–∑–∞–∫–æ–Ω—á–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –ø—Ä–æ—à–ª–æ–º', correctLeftId: 'left3' },
                { id: 'right4', text: '—Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ', correctLeftId: 'left4' }
            ];

            // —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            let student = { firstName: '', lastName: '' };
            let testStarted = false;
            let testCompleted = false;
            let timeLeft = 20; // 20 —Å–µ–∫
            let timerInterval = null;
            let startTimestamp = null;
            let endTimestamp = null;
            let testDurationSeconds = 0;

            // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∞–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ö—Ä–∞–Ω–∏–º id –ª–µ–≤–æ–≥–æ, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –æ–Ω –ø—Ä–∏–≤—è–∑–∞–Ω
            // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –≤—Å–µ –ø—Ä–∞–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã (null)
            let matches = {
                right0: null,
                right1: null,
                right2: null,
                right3: null,
                right4: null
            };

            // –î–ª—è drag & drop
            let draggedItem = null;

            const dynamicEl = document.getElementById('dynamicContent');
            const themeBtn = document.getElementById('themeSwitcher');

            themeBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark');
            });

            function render() {
                if (!testStarted) {
                    renderWelcome();
                } else if (testCompleted) {
                    renderResults();
                } else {
                    renderTest();
                }
            }

            function renderWelcome() {
                dynamicEl.innerHTML = `
                    <div class="user-section">
                        <h2 style="color: var(--navy); margin-bottom: 1.5rem;">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ</h2>
                        <div class="user-form">
                            <div class="input-group">
                                <label>–§–∞–º–∏–ª–∏—è</label>
                                <input type="text" id="lastNameInput" placeholder="–û—Ä–ª–æ–≤–∞" value="${student.lastName}">
                            </div>
                            <div class="input-group">
                                <label>–ò–º—è</label>
                                <input type="text" id="firstNameInput" placeholder="–ï–≤–∞" value="${student.firstName}">
                            </div>
                            <button class="btn-primary" id="startTestBtn">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
                        </div>
                    </div>
                `;

                document.getElementById('startTestBtn')?.addEventListener('click', () => {
                    const first = document.getElementById('firstNameInput')?.value.trim();
                    const last = document.getElementById('lastNameInput')?.value.trim();
                    if (!first || !last) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é.');
                        return;
                    }
                    student.firstName = first;
                    student.lastName = last;
                    testStarted = true;
                    startTimestamp = Date.now();
                    timeLeft = 20;
                    // —Å–±—Ä–æ—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π
                    matches = {
                        right0: null,
                        right1: null,
                        right2: null,
                        right3: null,
                        right4: null
                    };
                    startTimer();
                    render();
                });
            }

            function renderTest() {
                // –°–æ–∑–¥–∞—ë–º –ª–µ–≤—É—é –∫–æ–ª–æ–Ω–∫—É (—Ç–µ—Ä–º–∏–Ω—ã)
                const leftColumn = LEFT_ITEMS.map(item => {
                    // –ù–∞—Ö–æ–¥–∏–º, –∫–∞–∫–æ–π –ø—Ä–∞–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —ç—Ç–æ–º—É –ª–µ–≤–æ–º—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
                    const matchedRightId = Object.entries(matches).find(([rightId, leftId]) => leftId === item.id)?.[0];
                    const matchedRight = matchedRightId ? RIGHT_ITEMS.find(r => r.id === matchedRightId) : null;
                    
                    return `
                        <div class="left-item" id="${item.id}" data-left-id="${item.id}" style="background-color: var(--bg-card); border: 2px solid var(--navy); border-radius: 12px; padding: 1rem 1.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; min-height: 80px;">
                            <span style="font-weight: 600; color: var(--navy);">${item.text}</span>
                            <div class="attached-right" style="background-color: var(--accent); color: white; border-radius: 12px; padding: 0.5rem 1rem; max-width: 200px; text-align: center; ${matchedRight ? '' : 'display: none;'}">
                                ${matchedRight ? matchedRight.text : ''}
                            </div>
                            <div class="drop-zone" style="display: none;"></div>
                        </div>
                    `;
                }).join('');

                // –°–æ–∑–¥–∞—ë–º –ø—Ä–∞–≤—É—é –∫–æ–ª–æ–Ω–∫—É (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è) - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –Ω–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã
                const rightColumn = RIGHT_ITEMS.map(item => {
                    // –ï—Å–ª–∏ —ç—Ç–æ—Ç –ø—Ä–∞–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç —É–∂–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ –≤ –ø—Ä–∞–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ
                    if (matches[item.id] !== null) return '';
                    
                    return `
                        <div class="right-item" id="${item.id}" draggable="true" style="background-color: var(--accent); color: white; border-radius: 12px; padding: 1rem 1.5rem; margin-bottom: 1rem; cursor: grab; user-select: none; box-shadow: var(--shadow);">
                            ${item.text}
                        </div>
                    `;
                }).join('');

                dynamicEl.innerHTML = `
                    <div class="test-header">
                        <span class="progress">–û–°–¢–ê–õ–û–°–¨</span>
                        <span class="timer" id="timerDisplay">00:30</span>
                    </div>
                    
                    <div style="display: flex; gap: 2rem; flex-wrap: wrap; margin-bottom: 2rem;">
                        <div style="flex: 1; min-width: 250px;">
                            <h3 style="color: var(--navy); margin-bottom: 1rem;">–í—Ä–µ–º–µ–Ω–∞ (—Ç–µ—Ä–º–∏–Ω—ã)</h3>
                            <div id="leftContainer">
                                ${leftColumn}
                            </div>
                        </div>
                        <div style="flex: 1; min-width: 250px;">
                            <h3 style="color: var(--navy); margin-bottom: 1rem;">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (–ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ)</h3>
                            <div id="rightContainer">
                                ${rightColumn || '<p style="color: var(--text-secondary); font-style: italic;">–í—Å–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã</p>'}
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 2rem;">
                        <button class="btn-primary" id="resetDragBtn">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ</button>
                        <button class="btn-large" id="submitDragBtn">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</button>
                    </div>
                `;

                // --- Drag & Drop –ª–æ–≥–∏–∫–∞ ---
                const rightItems = document.querySelectorAll('.right-item');
                const leftItems = document.querySelectorAll('.left-item');

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                rightItems.forEach(item => {
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragend', handleDragEnd);
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∑–æ–Ω —Å–±—Ä–æ—Å–∞ (–ª–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã)
                leftItems.forEach(item => {
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('dragleave', handleDragLeave);
                    item.addEventListener('drop', handleDrop);
                });

                // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π
                document.getElementById('resetDragBtn').addEventListener('click', () => {
                    matches = {
                        right0: null,
                        right1: null,
                        right2: null,
                        right3: null,
                        right4: null
                    };
                    renderTest(); // –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–µ–º
                });

                document.getElementById('submitDragBtn').addEventListener('click', finishTest);
                updateTimerDisplay();
            }

            // --- Drag & Drop –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ---
            function handleDragStart(e) {
                draggedItem = this;
                this.style.opacity = '0.5';
                e.dataTransfer.setData('text/plain', this.id);
                e.dataTransfer.effectAllowed = 'move';
            }

            function handleDragEnd(e) {
                this.style.opacity = '1';
                // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö –ª–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                document.querySelectorAll('.left-item').forEach(item => {
                    item.style.backgroundColor = '';
                    item.style.borderColor = 'var(--navy)';
                });
                draggedItem = null;
            }

            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∑–æ–Ω—É —Å–±—Ä–æ—Å–∞
                this.style.backgroundColor = 'var(--bg-card)';
                this.style.borderColor = 'var(--accent)';
            }

            function handleDragLeave(e) {
                this.style.backgroundColor = '';
                this.style.borderColor = 'var(--navy)';
            }

            function handleDrop(e) {
                e.preventDefault();
                this.style.backgroundColor = '';
                this.style.borderColor = 'var(--navy)';
                
                const rightId = e.dataTransfer.getData('text/plain');
                const draggedElement = document.getElementById(rightId);
                if (!draggedElement) return;

                const leftId = this.id; // id –ª–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (left0, left1...)

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç –ª–∏ —É–∂–µ —ç—Ç–æ—Ç –ª–µ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
                const existingMatch = Object.entries(matches).find(([rId, lId]) => lId === leftId);
                if (existingMatch) {
                    alert('–≠—Ç–æ—Ç —Ç–µ—Ä–º–∏–Ω —É–∂–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω —Å –¥—Ä—É–≥–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º. –°–Ω–∞—á–∞–ª–∞ —Å–±—Ä–æ—Å—å—Ç–µ –∏–ª–∏ –æ—Ç–∫—Ä–µ–ø–∏—Ç–µ.');
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º –ª–∏ –º—ã –Ω–∞ —Ç–æ—Ç –∂–µ –ª–µ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
                if (matches[rightId] === leftId) return;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
                matches[rightId] = leftId;

                // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–µ–º, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                renderTest();
            }

            function renderResults() {
                // –ü–æ–¥—Å—á—ë—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                let correctCount = 0;
                RIGHT_ITEMS.forEach(item => {
                    const matchedLeftId = matches[item.id];
                    if (matchedLeftId === item.correctLeftId) {
                        correctCount++;
                    }
                });

                const percent = (correctCount / RIGHT_ITEMS.length) * 100;
                const passed = percent >= 100;

                const now = endTimestamp ? new Date(endTimestamp) : new Date();
                const dateStr = now.toLocaleDateString('ru-RU');
                const timeStr = now.toLocaleTimeString('ru-RU', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
                const durationMinutes = Math.floor(testDurationSeconds / 60);
                const durationSeconds = testDurationSeconds % 60;
                const durationStr = `${durationMinutes} –º–∏–Ω ${durationSeconds} —Å–µ–∫`;

                // –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
                const detailRows = LEFT_ITEMS.map((leftItem, idx) => {
                    // –ù–∞—Ö–æ–¥–∏–º, –∫–∞–∫–æ–π –ø—Ä–∞–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω —Å —ç—Ç–∏–º –ª–µ–≤—ã–º
                    const matchedRightEntry = Object.entries(matches).find(([rightId, leftId]) => leftId === leftItem.id);
                    const matchedRightId = matchedRightEntry ? matchedRightEntry[0] : null;
                    const matchedRight = matchedRightId ? RIGHT_ITEMS.find(r => r.id === matchedRightId) : null;
                    
                    const correctRight = RIGHT_ITEMS.find(r => r.correctLeftId === leftItem.id);
                    
                    const userAnsText = matchedRight ? matchedRight.text : '(–Ω–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)';
                    const correctText = correctRight ? correctRight.text : '‚Äî';
                    const status = (matchedRightId === correctRight?.id) ? '‚úì' : '‚úó';
                    
                    return `<tr><td>${idx+1}</td><td>${leftItem.text}</td><td>${userAnsText}</td><td>${status}</td><td>${correctText}</td></tr>`;
                }).join('');

                const modalHtml = `
                    <div class="modal" id="resultModal">
                        <div class="modal-content" style="max-width: 800px;">
                            <h2>${passed ? '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç' : '–†–µ–∑—É–ª—å—Ç–∞—Ç'}</h2>
                            <p><strong>${student.lastName} ${student.firstName}</strong></p>
                            ${passed ? '<div class="success-badge">‚úì —É—Å–ø–µ—à–Ω–æ (‚â•80%)</div>' : '<div class="fail-badge">‚úó –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ (<80%)</div>'}
                            <p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π: ${correctCount} –∏–∑ ${RIGHT_ITEMS.length} (${Math.round(percent)}%)</p>
                            <p>–î–∞—Ç–∞: ${dateStr} ¬∑ –í—Ä–µ–º—è: ${timeStr} ¬∑ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${durationStr}</p>
                            
                            <table style="width:100%; margin-top:1.5rem; border-collapse: collapse; text-align:left; font-size:0.9rem;">
                                <thead><tr style="border-bottom:2px solid var(--navy);">
                                    <th>#</th><th>–¢–µ—Ä–º–∏–Ω</th><th>–í–∞—à–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</th><th></th><th>–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ</th>
                                </tr></thead>
                                <tbody>${detailRows}</tbody>
                            </table>

                            ${!passed ? '<p style="margin-top:1rem;">‚ûú –ü—Ä–∏–≥–ª–∞—à–∞–µ–º –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ</p>' : ''}
                            <button class="modal-close" id="modalCloseBtn">${passed ? '–ó–∞–∫—Ä—ã—Ç—å' : '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞'}</button>
                        </div>
                    </div>
                `;

                dynamicEl.innerHTML = modalHtml;

                document.getElementById('modalCloseBtn').addEventListener('click', () => {
                    if (!passed) {
                        testStarted = false;
                        testCompleted = false;
                        student.firstName = '';
                        student.lastName = '';
                        timeLeft = 20;
                        if (timerInterval) clearInterval(timerInterval);
                        timerInterval = null;
                        render();
                    } else {
                        document.getElementById('resultModal')?.remove();
                        testStarted = false;
                        testCompleted = false;
                        student.firstName = '';
                        student.lastName = '';
                        timeLeft = 20;
                        if (timerInterval) clearInterval(timerInterval);
                        timerInterval = null;
                        render();
                    }
                });
            }

            function startTimer() {
                if (timerInterval) clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    if (testCompleted) return;
                    timeLeft -= 1;
                    if (timeLeft <= 0) {
                        timeLeft = 0;
                        clearInterval(timerInterval);
                        if (!testCompleted) finishTest();
                    }
                    updateTimerDisplay();
                }, 1000);
            }

            function updateTimerDisplay() {
                const timerEl = document.getElementById('timerDisplay');
                if (timerEl) {
                    const mins = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                    const secs = (timeLeft % 60).toString().padStart(2, '0');
                    timerEl.textContent = `${mins}:${secs}`;
                }
            }

            function finishTest() {
                if (testCompleted) return;
                clearInterval(timerInterval);
                timerInterval = null;
                endTimestamp = Date.now();
                testDurationSeconds = Math.round((endTimestamp - startTimestamp) / 1000);
                testCompleted = true;
                render();
            }

            render();
        })();
    </script>
</body>
</html>