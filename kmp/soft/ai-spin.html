<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kmp+</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
	<script src="d3.v7.min.js"></script>
    <style>
        :root {
            --primary: #325980;
            --secondary: #3498db;
            --light-bg: #f5f5f5;
            --white: #ffffff;
            --dark-text: #1e1e1e;
            --dark-bg: #2c3e50;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
			--primary-color: #3e76ad;
		--header-text-color: #ffffff;
		--border-radius: 8px;
        }

        .dark-theme {
            --primary: #bad4e6;
            --secondary: #325980;
            --light-bg: #2c3e50;
            --white: #304e70;
            --dark-text: #f5f5f5;
            --dark-bg: #121212;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-bg);
            color: var(--dark-text);
            transition: var(--transition);
        }

header {
    background-color: var(--primary-color);
    color: var(--header-text-color);
    padding: 20px 0;
    text-align: center;
    border-radius: var(--border-radius);
    margin-bottom: 20px;
    background-image: linear-gradient(135deg, var(--primary-color) 0%, #2c3e50 100%);
    display: flex; /* Добавьте это */
    justify-content: center; /* Добавьте это */
    align-items: center; /* Добавьте это */
    gap: 20px; /* Добавьте это, чтобы добавить пространство между заголовком и кнопкой */
}

        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--white);
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background-color: rgba(255,255,255,0.2);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
        }

        .module {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 20px;
            transition: var(--transition);
            overflow: hidden;
        }

        .module:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .module-title {
            font-size: 1.8rem;
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .slider-container label {
            min-width: 120px;
        }

        .slider-container input {
            flex-grow: 1;
        }

        .slider-value {
            min-width: 40px;
            text-align: right;
        }

        button {
            background-color: var(--primary);
            color: var(--white);
            border: none;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
            margin-top: 10px;
        }

        button:hover {
            background-color: var(--secondary);
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .canvas {
            width: 100%;
            height: 250px;
            border: 1px solid var(--secondary);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 10px;
        }

.comparison {
    grid-column: 1 / -1;
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
}

.comparison-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    align-items: center;
}

.metaphors {
    grid-column: 1 / -1;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin: 20px 0;
}

.compare-btn-container {
    grid-column: 1 / -1;
    text-align: center;
}


    footer {
      text-align: center;
      padding: 20px 0;
      margin-top: 40px;
      font-size: 0.9rem;
      border-top: 0px solid #ddd;
    }

        .arrow {
            font-size: 1.5rem;
            margin: 5px 0;
        }

        .text-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--secondary);
            border-radius: 8px;
            margin-bottom: 10px;
            background-color: var(--white);
            color: var(--dark-text);
        }

        .tree-visualization {
            height: 200px;
            border: 1px solid var(--secondary);
            border-radius: 8px;
            overflow: hidden;
			color: var(--dark-text);
        }

        .info {
            grid-column: 1 / -1;
        }

        .probability-bar {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .bar-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bar-label {
            min-width: 100px;
        }

        .bar {
            height: 20px;
            background-color: var(--secondary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .bar-value {
            min-width: 60px;
            text-align: right;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .comparison {
                grid-template-columns: 1fr;
            }
        }
		
		.comparison-canvas {
    height: 250px;
    border: 1px solid var(--secondary);
    border-radius: 8px;
    background-color: var(--white);
}

.metaphor {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 10px;
    background-color: var(--white);
    border-radius: 8px;
    box-shadow: var(--card-shadow);
}

.arrow {
    font-size: 1.5rem;
    margin: 5px 0;
    color: var(--primary);
}

.compare-btn-container {
    margin-top: 10px;
}

@media (max-width: 768px) {
    .comparison-container {
        grid-template-columns: 1fr;
    }
    
    .metaphors {
        grid-template-columns: 1fr;
    }
}
    </style>
</head>
<body>
    <header>
        <h1>Нейронная симуляция</h1>
		<button class="theme-toggle" id="themeToggle">☀️</button>
		</header>
	
	

    <div class="container">
        <!-- Модуль 1: Спиновое стекло -->
        <div class="module" id="spin-glass">
            <h2 class="module-title">Спиновое стекло</h2>
            <div class="canvas" id="spin-glass-canvas"></div>
            <div class="controls">
                <div class="slider-container">
                    <label for="temperature">Температура:</label>
					<input type="range" id="temperature" min="0.1" max="5" step="0.1" value="1">
                    <span class="slider-value" id="temperature-value">1.0</span>
                </div>
                <div class="slider-container">
                    <label for="interaction">Сила взаимодействий:</label>
                    <input type="range" id="interaction" min="0.1" max="2" step="0.1" value="1">
                    <span class="slider-value" id="interaction-value">1.0</span>
                </div>
                <div class="slider-container">
                    <label for="grid-size">Размер решетки:</label>
                    <input type="range" id="grid-size" min="5" max="15" step="1" value="10">
                    <span class="slider-value" id="grid-size-value">10</span>
                </div>
                <div class="button-group">
                    <button id="spin-reset">Сброс</button>
                    <button id="spin-save">Запомнить состояние</button>
                </div>
            </div>
        </div>

        <!-- Модуль 2: Языковая модель -->
        <div class="module" id="language-model">
            <h2 class="module-title">Языковая модель</h2>
            <input type="text" id="name-input" class="text-input" placeholder="Введите вашу фамилию...">
            <div class="tree-visualization" id="tree-canvas"></div>
            <div class="probability-bar" id="probability-container"></div>
            <div class="controls">
                <div class="slider-container">
                    <label for="lm-temperature">Температура:</label>
                    <input type="range" id="lm-temperature" min="0.1" max="2" step="0.1" value="1">
                    <span class="slider-value" id="lm-temperature-value">1.0</span>
                </div>
                <button id="generate-text">Сгенерировать продолжение</button>
            </div>
        </div>

        <!-- Модуль 3: Сопоставление -->
        <div class="module comparison" id="comparison">
    <h2 class="module-title">Сопоставление моделей</h2>
    <div class="comparison-container">
        <div class="comparison-canvas" id="spin-comparison"></div>
        <div class="comparison-canvas" id="lm-comparison"></div>
    </div>
    <div class="metaphors">
        <div class="metaphor">
            <div>"Фрустрация"</div>
            <div class="arrow">↓</div>
            <div>"Многозначность"</div>
        </div>
        <div class="metaphor">
            <div>"Минимум энергии"</div>
            <div class="arrow">↓</div>
            <div>"Вероятностный максимум"</div>
        </div>
        <div class="metaphor">
            <div>"Память"</div>
            <div class="arrow">↓</div>
            <div>"Предсказание"</div>
        </div>
    </div>
    <div class="compare-btn-container">
        <button id="compare-btn">Сравнить</button>
    </div>
</div>

        <!-- Модуль 4: Информационный блок -->
        <div class="module info" id="info">
            <h2 class="module-title">О приложении</h2>
            <p>Данное приложение демонстрирует связь между физическими моделями спиновых стекол и языковыми моделями в искусственном интеллекте.</p>
            
            <h3>Функциональность:</h3>
            <ul>
                <li><strong>Спиновое стекло</strong> - визуализация физической модели с узлами и связями, демонстрирующая стремление системы к минимуму энергии.</li>
                <li><strong>Языковая модель</strong> - n-граммная модель, показывающая вероятностное распределение при генерации текста.</li>
                <li><strong>Сопоставление</strong> - демонстрация аналогий между физическими и языковыми моделями.</li>
            </ul>
            
            <h3>Инструкция для студентов:</h3>
            <ol>
                <li>В модуле спинового стекла настройте параметры и наблюдайте за динамикой системы.</li>
                <li>В языковой модели введите свою фамилию и изучите вероятности продолжения предложения.</li>
                <li>В модуле сопоставления нажмите "Сравнить" для наглядной демонстрации аналогий.</li>
                <li>Экспериментируйте с настройками для лучшего понимания концепций.</li>
            </ol>
            
            <h3>Технологии:</h3>
            <p>Приложение разработано с использованием HTML5, CSS3, JavaScript и библиотеки D3.js для интерактивной визуализации данных.</p>
            
            
        </div>
    </div>
  <footer class="footer">
<div class="container">
<p>© 2025 | kmp | CC BY-NC-SA 4.0<br>
Разработано для студентов БрГУ имени А.С. Пушкина</p>
</div>
</footer>
<div style="position: fixed; bottom: 10px; right: 33px; opacity: 0.3; font-size: 14px;">kmp+</div>
    
    <script>
        // Переключение темы
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', function() {
            document.body.classList.toggle('dark-theme');
            themeToggle.textContent = document.body.classList.contains('dark-theme') ? '🌙' : '☀️';
        });

        // Обновление значений слайдеров
        const sliders = {
            'temperature': document.getElementById('temperature-value'),
            'interaction': document.getElementById('interaction-value'),
            'grid-size': document.getElementById('grid-size-value'),
            'lm-temperature': document.getElementById('lm-temperature-value')
        };

        Object.keys(sliders).forEach(id => {
            const slider = document.getElementById(id);
            slider.addEventListener('input', function() {
                sliders[id].textContent = parseFloat(this.value).toFixed(1);
                if (id === 'grid-size') {
                    sliders[id].textContent = parseInt(this.value);
                    resetSpinGlass();
                }
                updateVisualizations();
            });
        });

        // Модуль 1: Спиновое стекло
        let spinNodes = [];
        let spinLinks = [];
        let savedState = null;
        
        function initSpinGlass() {
            const size = parseInt(document.getElementById('grid-size').value);
            const width = document.getElementById('spin-glass-canvas').clientWidth;
            const height = document.getElementById('spin-glass-canvas').clientHeight;
            
            // Создаем узлы
            spinNodes = [];
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    spinNodes.push({
                        id: i * size + j,
                        x: (width * (j + 0.5)) / size,
                        y: (height * (i + 0.5)) / size,
                        spin: Math.random() > 0.5 ? 1 : -1
                    });
                }
            }
            
            // Создаем случайные связи
            spinLinks = [];
            for (let i = 0; i < spinNodes.length; i++) {
                for (let j = i + 1; j < spinNodes.length; j++) {
                    // Создаем связи с вероятностью 0.15
                    if (Math.random() < 0.15) {
                        spinLinks.push({
                            source: i,
                            target: j,
                            weight: Math.random() > 0.5 ? 1 : -1
                        });
                    }
                }
            }
            
            renderSpinGlass();
        }
        
        function renderSpinGlass() {
            const canvas = document.getElementById('spin-glass-canvas');
            d3.select(canvas).selectAll("*").remove();
            
            const svg = d3.select(canvas)
                .append("svg")
                .attr("width", "100%")
                .attr("height", "100%");
            
            // Рисуем связи
            svg.selectAll("line")
                .data(spinLinks)
                .enter()
                .append("line")
                .attr("x1", d => spinNodes[d.source].x)
                .attr("y1", d => spinNodes[d.source].y)
                .attr("x2", d => spinNodes[d.target].x)
                .attr("y2", d => spinNodes[d.target].y)
                .attr("stroke", d => d.weight > 0 ? "blue" : "red")
                .attr("stroke-width", 2)
                .attr("opacity", 0.6);
            
            // Рисуем узлы
            svg.selectAll("circle")
                .data(spinNodes)
                .enter()
                .append("circle")
                .attr("cx", d => d.x)
                .attr("cy", d => d.y)
                .attr("r", 8)
                .attr("fill", d => d.spin > 0 ? "#3498db" : "#e74c3c")
                .on("click", function(event, d) {
                    d.spin *= -1;
                    d3.select(this).attr("fill", d.spin > 0 ? "#3498db" : "#e74c3c");
                    updateSpinGlass();
                });
        }
        
        function updateSpinGlass() {
            const temperature = parseFloat(document.getElementById('temperature').value);
            const interaction = parseFloat(document.getElementById('interaction').value);
            
            // Обновляем состояния спинов по алгоритму Метрополиса
            for (let i = 0; i < spinNodes.length; i++) {
                let energy = 0;
                
                // Вычисляем энергию для текущего узла
                spinLinks.forEach(link => {
                    if (link.source === i) {
                        energy += -link.weight * spinNodes[i].spin * spinNodes[link.target].spin * interaction;
                    } else if (link.target === i) {
                        energy += -link.weight * spinNodes[i].spin * spinNodes[link.source].spin * interaction;
                    }
                });
                
                // Пробуем перевернуть спин
                const energyDiff = -2 * energy;
                const flipProb = Math.exp(-energyDiff / temperature);
                
                if (energyDiff < 0 || Math.random() < flipProb) {
                    spinNodes[i].spin *= -1;
                }
            }
            
            // Обновляем визуализацию
            d3.select("#spin-glass-canvas svg")
                .selectAll("circle")
                .data(spinNodes)
                .attr("fill", d => d.spin > 0 ? "#3498db" : "#e74c3c");
        }
        
        function resetSpinGlass() {
            initSpinGlass();
        }
        
        document.getElementById('spin-reset').addEventListener('click', resetSpinGlass);
        document.getElementById('spin-save').addEventListener('click', function() {
            savedState = JSON.parse(JSON.stringify(spinNodes));
        });
        
        // Модуль 2: Языковая модель
        const sentenceTemplates = [
            " старательно изучает курс \"Искусственный интеллект\"",
            " легкомысленно относится к курсу \"Искусственный интеллект\"",
            " все знает про ИИ и курс не нужен",
            " является Искусственным интеллектом, но скрывает это"
        ];
        
        let currentName = "";
        let selectedTemplate = -1;
        
        function updateLanguageModel() {
            const name = document.getElementById('name-input').value.trim();
            if (name === "") return;
            
            currentName = name;
            renderProbabilities();
        }
        
        function renderProbabilities() {
            const temperature = parseFloat(document.getElementById('lm-temperature').value);
            const container = document.getElementById('probability-container');
            container.innerHTML = '';
            
            // Создаем базовые вероятности для шаблонов
            let probs = [0.4, 0.3, 0.2, 0.2];
            
            // Применяем температуру
            if (temperature !== 1.0) {
                // Преобразуем вероятности с учетом температуры
                let logits = probs.map(p => Math.log(p));
                logits = logits.map(l => l / temperature);
                
                // Применяем softmax
                const maxLogit = Math.max(...logits);
                const expLogits = logits.map(l => Math.exp(l - maxLogit));
                const sumExp = expLogits.reduce((a, b) => a + b, 0);
                probs = expLogits.map(exp => exp / sumExp);
            }
            
            // Отображаем вероятности
            sentenceTemplates.forEach((template, i) => {
                const barContainer = document.createElement('div');
                barContainer.className = 'bar-container';
                
                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = `Вариант ${i+1}:`;
                
                const barWrapper = document.createElement('div');
                barWrapper.style.flexGrow = '1';
                
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.width = `${probs[i] * 100}%`;
                
                const value = document.createElement('div');
                value.className = 'bar-value';
                value.textContent = `${(probs[i] * 100).toFixed(1)}%`;
                
                barWrapper.appendChild(bar);
                barContainer.appendChild(label);
                barContainer.appendChild(barWrapper);
                barContainer.appendChild(value);
                container.appendChild(barContainer);
                
                // Добавляем обработчик клика для выбора шаблона
                barContainer.addEventListener('click', function() {
                    selectedTemplate = i;
                    renderTree();
                });
            });
            
            renderTree();
        }
        
        function renderTree() {
            const canvas = document.getElementById('tree-canvas');
            d3.select(canvas).selectAll("*").remove();
            
            if (currentName === "" || selectedTemplate === -1) return;
            
            const svg = d3.select(canvas)
                .append("svg")
                .attr("width", "100%")
                .attr("height", "100%");
            
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            
            // Рисуем корневой узел (имя)
            svg.append("circle")
                .attr("cx", width / 2)
                .attr("cy", 30)
                .attr("r", 15)
                .attr("fill", "#3498db");
                
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", 35)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .text(currentName.substring(0, 1));
            
            // Разбиваем выбранный шаблон на слова
            const words = sentenceTemplates[selectedTemplate].trim().split(" ");
            
            // Рисуем дерево
            const nodeRadius = 15;
            const levelHeight = (height - 60) / (words.length);
            
            // Рисуем имя полностью
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", 60)
                .attr("text-anchor", "middle")
                .text(currentName);
            
            // Рисуем линию от имени к первому слову
            svg.append("line")
                .attr("x1", width / 2)
                .attr("y1", 45)
                .attr("x2", width / 2)
                .attr("y2", 80)
                .attr("stroke", "#3498db")
                .attr("stroke-width", 2);
            
            // Рисуем слова и связи
            let prevY = 80;
            words.forEach((word, i) => {
                const y = prevY + levelHeight;
                
                // Рисуем линию
                svg.append("line")
                    .attr("x1", width / 2)
                    .attr("y1", prevY)
                    .attr("x2", width / 2)
                    .attr("y2", y - nodeRadius)
                    .attr("stroke", "#3498db")
                    .attr("stroke-width", 2);
                
                // Рисуем узел
                svg.append("circle")
                    .attr("cx", width / 2)
                    .attr("cy", y)
                    .attr("r", nodeRadius)
                    .attr("fill", "#3498db");
                
                // Рисуем текст слова
                svg.append("text")
                    .attr("x", width / 2 + nodeRadius + 10)
                    .attr("y", y + 5)
                    .attr("text-anchor", "start")
                    .text(word);
                
                prevY = y;
            });
        }
        
        document.getElementById('name-input').addEventListener('input', updateLanguageModel);
        document.getElementById('lm-temperature').addEventListener('input', updateLanguageModel);
        document.getElementById('generate-text').addEventListener('click', function() {
            const name = document.getElementById('name-input').value.trim();
            if (name === "") return;
            
            // Выбираем шаблон на основе вероятностей
            const temperature = parseFloat(document.getElementById('lm-temperature').value);
            let probs = [0.4, 0.3, 0.2, 0.1];
            
            // Применяем температуру
            if (temperature !== 1.0) {
                let logits = probs.map(p => Math.log(p));
                logits = logits.map(l => l / temperature);
                
                const maxLogit = Math.max(...logits);
                const expLogits = logits.map(l => Math.exp(l - maxLogit));
                const sumExp = expLogits.reduce((a, b) => a + b, 0);
                probs = expLogits.map(exp => exp / sumExp);
            }
            
            // Выбираем шаблон на основе вероятностей
            const rand = Math.random();
            let cumProb = 0;
            for (let i = 0; i < probs.length; i++) {
                cumProb += probs[i];
                if (rand < cumProb) {
                    selectedTemplate = i;
                    break;
                }
            }
            
            renderTree();
        });
        
        // Модуль 3: Сопоставление
        function initComparison() {
            // Клонируем спиновое стекло для сравнения
            const spinCanvas = document.getElementById('spin-comparison');
            const width = spinCanvas.clientWidth;
            const height = spinCanvas.clientHeight;
            
            d3.select(spinCanvas).selectAll("*").remove();
            const spinSvg = d3.select(spinCanvas)
                .append("svg")
                .attr("width", "100%")
                .attr("height", "100%");
            
            // Создаем упрощенную версию спинового стекла
            const size = 5;
            const nodes = [];
            const links = [];
            
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    nodes.push({
                        id: i * size + j,
                        x: (width * (j + 0.5)) / size,
                        y: (height * (i + 0.5)) / size,
                        spin: Math.random() > 0.5 ? 1 : -1
                    });
                }
            }
            
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    if (Math.random() < 0.2) {
                        links.push({
                            source: i,
                            target: j,
                            weight: Math.random() > 0.5 ? 1 : -1
                        });
                    }
                }
            }
            
            // Рисуем связи
            spinSvg.selectAll("line")
                .data(links)
                .enter()
                .append("line")
                .attr("x1", d => nodes[d.source].x)
                .attr("y1", d => nodes[d.source].y)
                .attr("x2", d => nodes[d.target].x)
                .attr("y2", d => nodes[d.target].y)
                .attr("stroke", d => d.weight > 0 ? "blue" : "red")
                .attr("stroke-width", 2)
                .attr("opacity", 0.6);
            
            // Рисуем узлы
            spinSvg.selectAll("circle")
                .data(nodes)
                .enter()
                .append("circle")
                .attr("cx", d => d.x)
                .attr("cy", d => d.y)
                .attr("r", 6)
                .attr("fill", d => d.spin > 0 ? "#3498db" : "#e74c3c");
            
            // Инициализируем языковую модель для сравнения
            const lmCanvas = document.getElementById('lm-comparison');
            d3.select(lmCanvas).selectAll("*").remove();
            
            const lmSvg = d3.select(lmCanvas)
                .append("svg")
                .attr("width", "100%")
                .attr("height", "100%");
            
            // Рисуем простую визуализацию языковой модели
            const wordCount = 5;
            const wordWidth = width / wordCount;
            
            for (let i = 0; i < wordCount; i++) {
                lmSvg.append("rect")
                    .attr("x", i * wordWidth)
                    .attr("y", height / 2 - 15)
                    .attr("width", wordWidth - 4)
                    .attr("height", 30)
                    .attr("fill", "#3498db")
                    .attr("opacity", 0.7 - i * 0.1);
                
                lmSvg.append("text")
                    .attr("x", i * wordWidth + wordWidth / 2)
                    .attr("y", height / 2 + 5)
                    .attr("text-anchor", "middle")
                    .attr("fill", "white")
                    .text("слово" + (i+1));
            }
            
            // Добавляем стрелки между словами
            for (let i = 0; i < wordCount - 1; i++) {
                lmSvg.append("line")
                    .attr("x1", i * wordWidth + wordWidth - 2)
                    .attr("y1", height / 2)
                    .attr("x2", (i + 1) * wordWidth)
                    .attr("y2", height / 2)
                    .attr("stroke", "#3498db")
                    .attr("stroke-width", 2)
                    .attr("marker-end", "url(#arrow)");
            }
            
            // Определяем маркер для стрелки
            lmSvg.append("defs").append("marker")
                .attr("id", "arrow")
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", 8)
                .attr("refY", 0)
                .attr("markerWidth", 6)
                .attr("markerHeight", 6)
                .attr("orient", "auto")
                .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .attr("fill", "#3498db");
        }
        
        function compareModels() {
            // Анимация сравнения
            const spinCanvas = document.getElementById('spin-comparison');
            const lmCanvas = document.getElementById('lm-comparison');
            
            // Добавляем класс для анимации
            spinCanvas.classList.add('comparing');
            lmCanvas.classList.add('comparing');
            
            // Через секунду убираем класс
            setTimeout(() => {
                spinCanvas.classList.remove('comparing');
                lmCanvas.classList.remove('comparing');
            }, 1000);
            
            // Обновляем визуализации
            const spinSvg = d3.select(spinCanvas).select("svg");
            spinSvg.selectAll("circle")
                .transition()
                .duration(500)
                .attr("fill", d => Math.random() > 0.5 ? "#3498db" : "#e74c3c");
            
            const lmSvg = d3.select(lmCanvas).select("svg");
            lmSvg.selectAll("rect")
                .transition()
                .duration(500)
                .attr("opacity", d => 0.3 + Math.random() * 0.7);
        }
        
        document.getElementById('compare-btn').addEventListener('click', compareModels);
        
        // Инициализация
        function init() {
            initSpinGlass();
            initComparison();
            
            // Добавляем стили для анимации сравнения
            const style = document.createElement('style');
            style.textContent = `
                .comparing {
                    animation: pulse 1s;
                }
                
                @keyframes pulse {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.05); box-shadow: 0 0 15px var(--secondary); }
                    100% { transform: scale(1); }
                }
            `;
            document.head.appendChild(style);
        }
        
        function updateVisualizations() {
            // Обновление визуализаций при изменении параметров
            if (document.getElementById('spin-glass-canvas').querySelector('svg')) {
                updateSpinGlass();
            }
            
            if (document.getElementById('name-input').value.trim() !== "") {
                updateLanguageModel();
            }
        }
        
        // Запуск приложения
        window.addEventListener('load', init);
    </script>
</body>
</html>